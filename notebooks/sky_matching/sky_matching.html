
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Sky Matching &#8212; Notebook repository template (CHANGE THIS)</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Notebook repository template (CHANGE THIS)</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    <no title>
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="(CHANGE THIS)"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="(CHANGE THIS)/issues/new?title=Issue%20on%20page%20%2Fnotebooks/sky_matching/sky_matching.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/sky_matching/sky_matching.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Sky Matching
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retrieve-observations-using-astroquery">
     1. Retrieve Observations using Astroquery
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#move-files-to-the-local-directory">
       Move files to the local directory
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inspect-the-image-headers">
       Inspect the image headers
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#align-the-visit-level-drizzled-data">
     2. Align the visit-level drizzled data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-skymethod-options-in-astrodrizzle">
     3. Compare
     <code class="docutils literal notranslate">
      <span class="pre">
       skymethod
      </span>
     </code>
     options in AstroDrizzle
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-localmin">
       <code class="docutils literal notranslate">
        <span class="pre">
         skymethod
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         'localmin'
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-match">
       <code class="docutils literal notranslate">
        <span class="pre">
         skymethod
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         'match'
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-globalmin-match">
       <code class="docutils literal notranslate">
        <span class="pre">
         skymethod
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         'globalmin+match'
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-globalmin">
       <code class="docutils literal notranslate">
        <span class="pre">
         skymethod
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         'globalmin'
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-the-mdrizsky-values-for-each-method">
     4. Compare the MDRIZSKY values for each method
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#display-the-full-matched-mosaic">
     5. Display the full ‘matched’ mosaic
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this Notebook
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Sky Matching</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Sky Matching
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retrieve-observations-using-astroquery">
     1. Retrieve Observations using Astroquery
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#move-files-to-the-local-directory">
       Move files to the local directory
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inspect-the-image-headers">
       Inspect the image headers
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#align-the-visit-level-drizzled-data">
     2. Align the visit-level drizzled data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-skymethod-options-in-astrodrizzle">
     3. Compare
     <code class="docutils literal notranslate">
      <span class="pre">
       skymethod
      </span>
     </code>
     options in AstroDrizzle
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-localmin">
       <code class="docutils literal notranslate">
        <span class="pre">
         skymethod
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         'localmin'
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-match">
       <code class="docutils literal notranslate">
        <span class="pre">
         skymethod
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         'match'
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-globalmin-match">
       <code class="docutils literal notranslate">
        <span class="pre">
         skymethod
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         'globalmin+match'
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-globalmin">
       <code class="docutils literal notranslate">
        <span class="pre">
         skymethod
        </span>
        <span class="pre">
         =
        </span>
        <span class="pre">
         'globalmin'
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-the-mdrizsky-values-for-each-method">
     4. Compare the MDRIZSKY values for each method
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#display-the-full-matched-mosaic">
     5. Display the full ‘matched’ mosaic
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this Notebook
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="sky-matching">
<h1>Sky Matching<a class="headerlink" href="#sky-matching" title="Permalink to this headline">#</a></h1>
<div class="alert-danger">Note: The notebook in this repository 'Initialization.ipynb' goes over many of the basic concepts such as the setup of the environment/package installation and should be read first if you are new to HST images, DrizzlePac, or Astroquery.</div><section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>When a user decided to mosaic several images it can be difficult to decide how to relate the background of one image to the others. AstroDrizzle has the ability to compute and then either subtract or equalize the background in input images in order to match the sky between those images. The function allows users to select the algorithm for the sky subtraction using the <code class="docutils literal notranslate"><span class="pre">skymethod</span></code> parameter.</p>
<p>There are four methods available in sky matching: ‘localmin’, ‘match’, ‘globalmin’, ‘globalmin+match’.</p>
<p>By applying <code class="docutils literal notranslate"><span class="pre">drizzlepac.sky.sky()</span></code>, or by applying the <code class="docutils literal notranslate"><span class="pre">skymethod</span></code> parameter in the call to <code class="docutils literal notranslate"><span class="pre">drizzlepac.astrodrizzle.AstroDrizzle()</span></code>, AstroDrizzle will update the keyword <code class="docutils literal notranslate"><span class="pre">MDRIZSKY</span></code> in the headers of the input files.</p>
<p>The <strong>recommended</strong> use for images with sparse fields that have few astronomical sources is <code class="docutils literal notranslate"><span class="pre">skymethod</span> <span class="pre">=</span> <span class="pre">localmin</span></code> and for images with complicated backgrounds, such as nebulae and large host galaxies, <code class="docutils literal notranslate"><span class="pre">skymethod</span> <span class="pre">=</span> <span class="pre">match</span></code> is recommended.</p>
<p>For more information on the specifics of this function please refer to the documentation <a class="reference external" href="https://drizzlepac.readthedocs.io/en/deployment/sky.html#drizzlepac.sky.sky">here</a>.</p>
<p>Below, each of the four methods will be demonstrated using a single example dataset, and differences between the methods will be highlighted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># All imports needed through out this notebook are included at the beginning. </span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">astropy_mpl_style</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">ImageFileCollection</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">drizzlepac</span>
<span class="kn">from</span> <span class="nn">drizzlepac</span> <span class="kn">import</span> <span class="n">tweakreg</span>
<span class="kn">from</span> <span class="nn">drizzlepac</span> <span class="kn">import</span> <span class="n">tweakback</span>
<span class="kn">from</span> <span class="nn">stwcs</span> <span class="kn">import</span> <span class="n">updatewcs</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">astropy_mpl_style</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">ImageFileCollection</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;ccdproc&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="retrieve-observations-using-astroquery">
<h2>1. Retrieve Observations using Astroquery<a class="headerlink" href="#retrieve-observations-using-astroquery" title="Permalink to this headline">#</a></h2>
<p>WFC3/IR observations of the Horsehead Nebula obtained in HST proposal 12812 (PI: Levay) will be used for this demonstration. The images have been processed by the HST WFC3 pipeline (calwf3), which includes bias subtraction, dark current correction, cosmic-ray rejection, and flatfielding.</p>
<p>The alignment specifics for this example are based on the example found <a class="reference external" href="https://archive.stsci.edu/prepds/heritage/horsehead/readme_HLSP_v3.txt">here</a>. We will provide explanation about the process as we go.</p>
<p>The code used to retrieve the data from astroquery is below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve the observation information.</span>
<span class="n">obs_table</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="s1">&#39;12812&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;F160W&quot;</span><span class="p">],</span> <span class="n">project</span><span class="o">=</span><span class="s1">&#39;HST&#39;</span><span class="p">)</span>
<span class="n">obs_table</span><span class="o">.</span><span class="n">show_in_notebook</span><span class="p">()</span>

<span class="c1"># Figure out the downloadable products:</span>
<span class="n">dataProductsByObservation</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs_table</span><span class="p">)</span>
<span class="n">dataProductsByObservation</span><span class="o">.</span><span class="n">show_in_notebook</span><span class="p">()</span>

<span class="c1"># Download the flc.fits files: </span>
<span class="n">obsids</span> <span class="o">=</span> <span class="n">obs_table</span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">]</span>

<span class="c1"># Download the data - uncomment to download: </span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">obsids</span><span class="p">,</span> <span class="n">mrp_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;FLT&#39;</span><span class="p">,</span> <span class="s1">&#39;DRZ&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="move-files-to-the-local-directory">
<h3>Move files to the local directory<a class="headerlink" href="#move-files-to-the-local-directory" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flt_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;mastDownload/*/*/*flt.fits&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">flt_files</span><span class="p">:</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">rootname</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;ROOTNAME&#39;</span><span class="p">]</span>
    <span class="n">im</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">rootname</span> <span class="o">+</span> <span class="s2">&quot;_flt.fits&quot;</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

<span class="n">drz_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;mastDownload/*/*/*drz.fits&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">drz_files</span><span class="p">:</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">rootname</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;ROOTNAME&#39;</span><span class="p">]</span>
    <span class="n">im</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">rootname</span> <span class="o">+</span> <span class="s2">&quot;_drz.fits&quot;</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inspect-the-image-headers">
<h3>Inspect the image headers<a class="headerlink" href="#inspect-the-image-headers" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collect_flt</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">glob_include</span><span class="o">=</span><span class="s2">&quot;*flt.fits&quot;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                  <span class="n">keywords</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;asn_id&quot;</span><span class="p">,</span> <span class="s2">&quot;detector&quot;</span><span class="p">,</span> <span class="s2">&quot;filter&quot;</span><span class="p">,</span> <span class="s2">&quot;exptime&quot;</span><span class="p">,</span> <span class="s2">&quot;postarg1&quot;</span><span class="p">,</span> <span class="s2">&quot;postarg2&quot;</span><span class="p">])</span>
    
<span class="n">flt_table</span> <span class="o">=</span> <span class="n">collect_flt</span><span class="o">.</span><span class="n">summary</span>
<span class="n">flt_table</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.1f&#39;</span>
<span class="n">flt_table</span><span class="p">[</span><span class="s1">&#39;postarg1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.2f&#39;</span>
<span class="n">flt_table</span><span class="p">[</span><span class="s1">&#39;postarg2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.2f&#39;</span>
<span class="n">flt_table</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collect_drz</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">glob_include</span><span class="o">=</span><span class="s2">&quot;*drz.fits&quot;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                  <span class="n">keywords</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;asn_id&quot;</span><span class="p">,</span> <span class="s2">&quot;detector&quot;</span><span class="p">,</span> <span class="s2">&quot;filter&quot;</span><span class="p">,</span> <span class="s2">&quot;exptime&quot;</span><span class="p">])</span>
    
<span class="n">drz_table</span> <span class="o">=</span> <span class="n">collect_drz</span><span class="o">.</span><span class="n">summary</span>
<span class="n">drz_table</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;7.1f&#39;</span>
<span class="n">drz_table</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="align-the-visit-level-drizzled-data">
<h2>2. Align the visit-level drizzled data<a class="headerlink" href="#align-the-visit-level-drizzled-data" title="Permalink to this headline">#</a></h2>
<p>Exposures obtained within a single HST visit tend to be aligned very well since they use the same guide stars. Thus, we will use TweakReg to align the DRZ files and then use TweakBack to propagate those solutions back to the FLT image headers prior to combining with AstroDrizzle. Making use of the parameter <code class="docutils literal notranslate"><span class="pre">expand_refcat</span></code>, TweakReg will build up an expanded reference catalog on the sky to be used for alignment. For this dataset, we obtain the best results when we tell TweakReg to align the DRZ files in a specific order, and this is achieved by giving a list of files as input. More details on alignment of HST mosaics can be found in the notebook ‘mosaics.ipynb’ in this repository.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drz.list
ibxl54030_drz.fits	&lt;-- Note that tile 54 is the reference and is listed first
ibxl51030_drz.fits  
ibxl53030_drz.fits
ibxl55030_drz.fits
ibxl57030_drz.fits
ibxl50030_drz.fits
ibxl52030_drz.fits
ibxl56030_drz.fits
ibxl58030_drz.fits
  ____ ____ ____
 |    |    |    |    &lt;-- The 4 tiles with the most overlap are aligned first
 |    | 55 |    |
 |____|____|____|
 |    |    |    |
 | 57 | 54 | 51 |
 |____|____|____|
 |    |    |    |
 |    | 53 |    |
 |____|____|____|

  ____ ____ ____
 |    |    |    |    &lt;-- Then the corner tiles are added 
 | 58 |    | 52 |
 |____|____|____|
 |    |    |    |
 |    |    |    |
 |____|____|____|
 |    |    |    |
 | 56 |    | 50 |
 |____|____|____|
</pre></div>
</div>
<p>This allows TweakReg to start with the tiles with the most overlap first and then build upon that, expanding the reference catalog as each new tile is aligned.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;@drz.list&#39;</span><span class="p">,</span> 
                  <span class="n">imagefindcfg</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;conv_width&#39;</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span> <span class="s1">&#39;peakmin&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> 
                  <span class="n">minobj</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                  <span class="n">shiftfile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">expand_refcat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">enforce_user_order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">outshifts</span><span class="o">=</span><span class="s1">&#39;shift4_drc.txt&#39;</span><span class="p">,</span>
                  <span class="n">searchrad</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                  <span class="n">ylimit</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                  <span class="n">updatehdr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Tweakback is then run on the aligned DRZ files to propogate the updated WCS information back to the FLT files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drz_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;i*_drz.fits&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">drz_files</span><span class="p">:</span>
    <span class="n">tweakback</span><span class="o">.</span><span class="n">tweakback</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-skymethod-options-in-astrodrizzle">
<h2>3. Compare  <code class="docutils literal notranslate"><span class="pre">skymethod</span></code> options in AstroDrizzle<a class="headerlink" href="#compare-skymethod-options-in-astrodrizzle" title="Permalink to this headline">#</a></h2>
<section id="skymethod-localmin">
<h3><code class="docutils literal notranslate"><span class="pre">skymethod</span> <span class="pre">=</span> <span class="pre">'localmin'</span></code><a class="headerlink" href="#skymethod-localmin" title="Permalink to this headline">#</a></h3>
<p>When using AstroDrizzle to compute the sky in each frame, ‘localmin’ will compute a common sky for all members of an exposure, as described <a class="reference external" href="https://drizzlepac.readthedocs.io/en/deployment/sky.html#drizzlepac.sky.sky">here</a>. This algorithm is recommended when images are dominated by blank sky instead of extended, diffuse sources.</p>
<p>For a typical use, it will compute sky values for each chip/image extension (marked for sky subtraction in the input parameter) in an input image, and it will subtract the previously found minimum sky value from all chips in that image. This process is repeated for each input image.</p>
<p>In the command below, the aligned FLT frames are sky subtracted and drizzled together. Because the WFC3/IR data products are already cleaned of cosmic rays during calwf3 processing, cosmic-ray rejection is turned off in AstroDrizzle by setting the parameters <code class="docutils literal notranslate"><span class="pre">driz_separate</span></code>, <code class="docutils literal notranslate"><span class="pre">median</span></code>, <code class="docutils literal notranslate"><span class="pre">blot</span></code>, and <code class="docutils literal notranslate"><span class="pre">driz_cr</span></code> to ‘False’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drizzlepac</span><span class="o">.</span><span class="n">astrodrizzle</span><span class="o">.</span><span class="n">AstroDrizzle</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">,</span> 
                                     <span class="n">output</span><span class="o">=</span><span class="s1">&#39;f160w_localmin&#39;</span><span class="p">,</span>
                                     <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">skymethod</span><span class="o">=</span><span class="s1">&#39;localmin&#39;</span><span class="p">,</span> 
                                     <span class="n">driz_separate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">blot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">driz_cr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;64&#39;</span><span class="p">,</span>
                                     <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                     <span class="n">final_rot</span><span class="o">=</span><span class="mf">257.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="skymethod-match">
<h3><code class="docutils literal notranslate"><span class="pre">skymethod</span> <span class="pre">=</span> <span class="pre">'match'</span></code><a class="headerlink" href="#skymethod-match" title="Permalink to this headline">#</a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">skymethod</span></code> is set to ‘match’, differences in sky values between images in common sky regions will be computed. Thus, sky values will be relative (delta) to the sky computed in one of the input images whose sky value will be set to and reported as 0. This setting “equalizes” sky values between the images in large mosaics.</p>
<p>This is the <strong>recommended</strong> setting for images containing diffuse sources (e.g., galaxies, nebulae) covering significant parts of the image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drizzlepac</span><span class="o">.</span><span class="n">astrodrizzle</span><span class="o">.</span><span class="n">AstroDrizzle</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">,</span> 
                                     <span class="n">output</span><span class="o">=</span><span class="s1">&#39;f160w_match&#39;</span><span class="p">,</span>
                                     <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">skymethod</span><span class="o">=</span><span class="s1">&#39;match&#39;</span><span class="p">,</span>
                                     <span class="n">driz_separate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">blot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">driz_cr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;64&#39;</span><span class="p">,</span>
                                     <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                     <span class="n">final_rot</span><span class="o">=</span><span class="mf">257.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="skymethod-globalmin-match">
<h3><code class="docutils literal notranslate"><span class="pre">skymethod</span> <span class="pre">=</span> <span class="pre">'globalmin+match'</span></code><a class="headerlink" href="#skymethod-globalmin-match" title="Permalink to this headline">#</a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">skymethod</span></code> is set to ‘globalmin+match’, AstroDrizzle will first find a minimum “global” sky value in all input images and then use the ‘match’ method to equalize sky values between images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drizzlepac</span><span class="o">.</span><span class="n">astrodrizzle</span><span class="o">.</span><span class="n">AstroDrizzle</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">,</span> 
                                     <span class="n">output</span><span class="o">=</span><span class="s1">&#39;f160w_globalmin_match&#39;</span><span class="p">,</span>
                                     <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">skymethod</span><span class="o">=</span><span class="s1">&#39;globalmin+match&#39;</span><span class="p">,</span>
                                     <span class="n">driz_separate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">blot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">driz_cr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;64&#39;</span><span class="p">,</span>
                                     <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                     <span class="n">final_rot</span><span class="o">=</span><span class="mf">257.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="skymethod-globalmin">
<h3><code class="docutils literal notranslate"><span class="pre">skymethod</span> <span class="pre">=</span> <span class="pre">'globalmin'</span></code><a class="headerlink" href="#skymethod-globalmin" title="Permalink to this headline">#</a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">skymethod</span></code> is set to ‘globalmin’, a common sky value will be computed for all exposures. AstroDrizzle will compute sky values for each chip/image extension, find the minimum sky value from all the exposures, and then subtract that minimum sky value from all chips in all images.</p>
<p>This method may be useful when input images already have matched background values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drizzlepac</span><span class="o">.</span><span class="n">astrodrizzle</span><span class="o">.</span><span class="n">AstroDrizzle</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">,</span> 
                                     <span class="n">output</span><span class="o">=</span><span class="s1">&#39;f160w_globalmin&#39;</span><span class="p">,</span>     
                                     <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">skymethod</span><span class="o">=</span><span class="s1">&#39;globalmin&#39;</span><span class="p">,</span>     
                                     <span class="n">driz_separate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">blot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">driz_cr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                     <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;64&#39;</span><span class="p">,</span>
                                     <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                     <span class="n">final_rot</span><span class="o">=</span><span class="mf">257.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="compare-the-mdrizsky-values-for-each-method">
<h2>4. Compare the MDRIZSKY values for each method<a class="headerlink" href="#compare-the-mdrizsky-values-for-each-method" title="Permalink to this headline">#</a></h2>
<p>Below we provide a gif comparing the upper portion of the final drizzled image. We cycle through three of the versions that use different <code class="docutils literal notranslate"><span class="pre">skymethod</span></code> algorithms:</p>
<p><img alt="SegmentLocal" src="../../_images/labeled_local_globalmatch_match.gif" /></p>
<p>Below is the code used to compare results from the various skymatching methods. It’s best practice to use more compact for loops when possible in situations like this, but we wanted to write out each file to ensure we are gathering the proper <code class="docutils literal notranslate"><span class="pre">MDRIZSKY</span></code> values for each <code class="docutils literal notranslate"><span class="pre">skymethod</span></code> run. We also display a table (Pandas DataFrame) of the different sky matching <code class="docutils literal notranslate"><span class="pre">MDRIZSKY</span></code> values for comparison.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a quick method of opening our different results and gathering the `MDRIZSKY` values: </span>
<span class="n">im</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;f160w_globalmin_drz_sci.fits&quot;</span><span class="p">)</span>
<span class="n">rootname</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ROOTNAME&#39;</span><span class="p">]</span>
<span class="n">asn_id</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ASN_ID&#39;</span><span class="p">]</span>
<span class="n">orientat</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ORIENTAT&#39;</span><span class="p">]</span>
<span class="n">mdrizsky</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MDRIZSKY&#39;</span><span class="p">]</span>
<span class="n">im</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;f160w_globalmin_match_drz_sci.fits&quot;</span><span class="p">)</span>
<span class="n">globalmatchrootname</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ROOTNAME&#39;</span><span class="p">]</span>
<span class="n">asn_id</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ASN_ID&#39;</span><span class="p">]</span>
<span class="n">orientat</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ORIENTAT&#39;</span><span class="p">]</span>
<span class="n">globalmatchmdrizsky</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MDRIZSKY&#39;</span><span class="p">]</span>
<span class="n">im</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;f160w_match_drz_sci.fits&quot;</span><span class="p">)</span>
<span class="n">matchrootname</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ROOTNAME&#39;</span><span class="p">]</span>
<span class="n">asn_id</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ASN_ID&#39;</span><span class="p">]</span>
<span class="n">orientat</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ORIENTAT&#39;</span><span class="p">]</span>
<span class="n">matchmdrizsky</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MDRIZSKY&#39;</span><span class="p">]</span>
<span class="n">im</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;f160w_localmin_drz_sci.fits&quot;</span><span class="p">)</span>
<span class="n">localrootname</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ROOTNAME&#39;</span><span class="p">]</span>
<span class="n">asn_id</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ASN_ID&#39;</span><span class="p">]</span>
<span class="n">orientat</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ORIENTAT&#39;</span><span class="p">]</span>
<span class="n">localmdrizsky</span> <span class="o">=</span> <span class="n">im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MDRIZSKY&#39;</span><span class="p">]</span>
<span class="n">im</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">mdrizsky_val</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;Rootname&#39;</span><span class="p">:</span> <span class="n">rootname</span><span class="p">,</span>
     <span class="s1">&#39;globalmin&#39;</span><span class="p">:</span> <span class="n">mdrizsky</span><span class="p">,</span>
     <span class="s1">&#39;globalmin_match&#39;</span><span class="p">:</span> <span class="n">globalmatchmdrizsky</span><span class="p">,</span>
     <span class="s1">&#39;match&#39;</span><span class="p">:</span> <span class="n">matchmdrizsky</span><span class="p">,</span>
     <span class="s1">&#39;local&#39;</span><span class="p">:</span> <span class="n">localmdrizsky</span><span class="p">})</span>

<span class="n">mdrizsky_val</span>
</pre></div>
</div>
</div>
</div>
<p>These computed sky values can be visualized in the plot below. To reiterate, the MDRIZSKY keyword reports the value subtracted from each image, and not the sky level itself. Thus the values for <code class="docutils literal notranslate"><span class="pre">skymethod='match'</span></code> are close to zero. We also note that varying background levels across the individual tiles result in inaccurate sky background determination when <code class="docutils literal notranslate"><span class="pre">skymethod='match'</span></code> and thus a mismatched sky in the final mosaic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">mdrizsky_val</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">globalmin</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mdrizsky_val</span><span class="p">[</span><span class="s1">&#39;globalmin&#39;</span><span class="p">])</span>
<span class="n">globalmin_match</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mdrizsky_val</span><span class="p">[</span><span class="s1">&#39;globalmin_match&#39;</span><span class="p">])</span>
<span class="n">match</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mdrizsky_val</span><span class="p">[</span><span class="s1">&#39;match&#39;</span><span class="p">])</span>
<span class="n">local</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mdrizsky_val</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">])</span>

<span class="c1">#Plotting code: </span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">globalmin_match</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Globalmin + Match&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Match&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">local</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;olive&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Local&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">globalmin</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Globalmin&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Individual Images&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;MDRIZSKY Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-the-full-matched-mosaic">
<h2>5. Display the full ‘matched’ mosaic<a class="headerlink" href="#display-the-full-matched-mosaic" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sci</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;f160w_match_drz_sci.fits&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sci</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="about-this-notebook">
<h1>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Author: C. Martlin, STScI WFC3 Team  
Updated: December, 14 2018
</pre></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "None/None",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/sky_matching"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI (CHANGE AS NEEDED)<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>